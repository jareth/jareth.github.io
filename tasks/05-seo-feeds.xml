<?xml version="1.0" encoding="UTF-8"?>
<task>
  <meta>
    <id>05</id>
    <name>SEO and Feed Configuration</name>
    <phase>5</phase>
    <status>pending</status>
    <dependencies>02, 03</dependencies>
  </meta>

  <description>
    Create RSS feed, sitemap, and SEO meta tags to replace Jekyll plugins.
  </description>

  <steps>
    <step number="5.1">
      <action>Create feed.njk for RSS (replaces jekyll-feed)</action>
      <file>feed.njk</file>
      <content><![CDATA[
---
permalink: /feed.xml
eleventyExcludeFromCollections: true
---
<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>{{ site.title }}</title>
  <link href="{{ site.url }}/feed.xml" rel="self"/>
  <link href="{{ site.url }}/"/>
  <updated>{{ collections.posts | getNewestCollectionItemDate | dateToRfc3339 }}</updated>
  <id>{{ site.url }}/</id>
  <author>
    <name>Jareth van Bone</name>
  </author>
  {%- for post in collections.posts | reverse %}
  <entry>
    <title>{{ post.data.title }}</title>
    <link href="{{ site.url }}{{ post.url }}"/>
    <updated>{{ post.date | dateToRfc3339 }}</updated>
    <id>{{ site.url }}{{ post.url }}</id>
    <content type="html">{{ post.templateContent | htmlToAbsoluteUrls(site.url) }}</content>
  </entry>
  {%- endfor %}
</feed>
]]></content>
    </step>

    <step number="5.2">
      <action>Create sitemap.njk (replaces jekyll-sitemap)</action>
      <file>sitemap.njk</file>
      <content><![CDATA[
---
permalink: /sitemap.xml
eleventyExcludeFromCollections: true
---
<?xml version="1.0" encoding="utf-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  {%- for page in collections.all %}
  {%- if page.url %}
  <url>
    <loc>{{ site.url }}{{ page.url }}</loc>
    <lastmod>{{ page.date | date: "%Y-%m-%d" }}</lastmod>
  </url>
  {%- endif %}
  {%- endfor %}
</urlset>
]]></content>
    </step>

    <step number="5.3">
      <action>Add SEO meta tags to default.html (replaces jekyll-seo-tag)</action>
      <location>_layouts/default.html head section</location>
      <content><![CDATA[
<meta name="description" content="{{ description | default: site.description }}">
<meta property="og:title" content="{{ title | default: site.title }}">
<meta property="og:description" content="{{ description | default: site.description }}">
<meta property="og:url" content="{{ site.url }}{{ page.url }}">
<meta property="og:type" content="website">
<link rel="canonical" href="{{ site.url }}{{ page.url }}">
]]></content>
    </step>
  </steps>

  <verification>
    <check>/feed.xml generates valid Atom XML</check>
    <check>/sitemap.xml lists all pages</check>
    <check>SEO meta tags appear in page source</check>
  </verification>
</task>
