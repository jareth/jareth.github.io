<?xml version="1.0" encoding="UTF-8"?>
<task>
  <meta>
    <id>02</id>
    <name>Update Templates for Eleventy</name>
    <phase>2</phase>
    <status>pending</status>
    <dependencies>01</dependencies>
  </meta>

  <description>
    Update all layouts, includes, and page templates to use Eleventy syntax.
  </description>

  <steps>
    <step number="2.1">
      <action>Update _layouts/default.html</action>
      <changes>
        <change from="site.data.manifest['main.css']" to="manifest['main.css']" />
        <change from="site.data.manifest['main.js']" to="manifest['main.js']" />
        <change from="jekyll.environment == 'production'" to="eleventy.env.runMode == 'build'" />
        <change from="site.data.navigation" to="navigation" />
      </changes>
      <notes>
        <note>Eleventy uses simpler data access: data files are available directly by filename</note>
        <note>site.title becomes site.title (same in _data/site.yml or front matter)</note>
      </notes>
    </step>

    <step number="2.2">
      <action>Update _includes/navigation.html</action>
      <changes>
        <change from="site.data.navigation" to="navigation" />
        <change from="page.url == item.link" to="page.url == item.link" reason="Same syntax works" />
      </changes>
    </step>

    <step number="2.3">
      <action>Update _includes/analytics.html</action>
      <changes>
        <change description="No changes needed - static HTML partial" />
      </changes>
    </step>

    <step number="2.4">
      <action>Update _includes/video.html</action>
      <changes>
        <change description="No changes needed - uses include parameters which work in Eleventy" />
      </changes>
    </step>

    <step number="2.5">
      <action>Update projects.html listing page</action>
      <changes>
        <change from="{% for project in site.projects %}" to="{% for project in collections.projects %}" />
        <change from="project.url" to="project.url" reason="Same in Eleventy" />
        <change from="project.preview" to="project.data.preview" reason="Front matter accessed via .data" />
        <change from="project.name" to="project.data.name" />
      </changes>
    </step>

    <step number="2.6">
      <action>Update blog.html listing page</action>
      <changes>
        <change from="{% for post in site.posts %}" to="{% for post in collections.posts %}" />
        <change from="post.title" to="post.data.title" />
        <change from="post.url" to="post.url" />
      </changes>
    </step>

    <step number="2.7">
      <action>Update _layouts/project.html</action>
      <changes>
        <change from="page.name" to="name" reason="Front matter available directly in layouts" />
        <change from="page.client" to="client" />
      </changes>
    </step>

    <step number="2.8">
      <action>Update _layouts/post.html</action>
      <changes>
        <change from="page.title" to="title" />
        <change from="page.date" to="date" />
        <change from="page.author" to="author" />
        <change from="page.date | date: '%B %d, %Y'" to="date | date: '%B %d, %Y'" />
      </changes>
    </step>
  </steps>

  <verification>
    <check>All template files parse without Liquid errors</check>
    <check>Data references use Eleventy syntax</check>
    <check>Collection loops use collections.* prefix</check>
  </verification>
</task>
